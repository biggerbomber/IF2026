---
title: "Plane Crash Analysis: There exist such a thing as a safest seat?"
subtitle: "Inferential Statistics 2025/2026"
author: "Barbato Alberto, Naldoni Martina"
date: "`r Sys.Date()`"
output: 
  pdf_document: 
    toc: true
    fig_height: 6
    number_sections: true
editor_options: 
  markdown: 
    wrap: 80
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

The Aviation industry is one of the safest in the world. The systems that it has in place to learn lessons from accidents and make sure they never happen again is well-established and highly regarded. This has made travelling by plane the safest way to travel. 
https://flyfright.com/plane-crash-statistics/#:~:text=Based%20on%20statistics%20from%202015,unharmed%2C%20injured%2C%20or%20killed

But perhaps due to these high safety standards, when an aircraft accident happens it makes headlines all over the world. Anxious passengers fear it's going to happen to them as well and they can't help but ask themselves if there is something they could do to have a safer flight. 

One of the most frequent question that gets asked is : is there a part of the plane that is "safer" than other parts? Can the seating location make a difference in an accident? 
There are many articles where experts in the field give their opinions, and most answer that "yes, there are areas that give a higher chance of survival in case of an aircraft accident". 
But there are also studies that suggest that there is no safest seats on an airplane. 

So, who is right? We are going to try to answer this question using statistics.

# Vocabulary

Before starting the analysis, the meaning of some terms must be clarified 

 - Flight : A flight a trip made by an aircraft that connects two airports. It is identified by a number. (Example : AirFrance 225 is the name of the regular service from New Deli to Paris ) 
 
 - Accident : An Accident is an occurrence where a person is fatally or seriously injured, the aircraft sustains significant structural damage, or the aircraft goes missing.
 
 - Incident : An incident is a dangerous situation where no one is seriously hurt and the plane isn't badly damaged.
 
 - Crash : A crash is a type of accident where an aircraft strikes the ground, water, or an obstacle with enough force to cause severe damage or total destruction.
 
 - Accident flight : when a serious accident happens on a flight, usually the companies save the flight number to refer to that flight, and change the flight number for new flights. (Example : Air France 447 was the name of the connection from Rio to Paris, after the 2009 accident the flight became Air France 445)
 
 - Serious injury : Any injury requiring more than 48 hours of hospitalization or involving broken bones (other than fingers/toes)

# Perspective 

We are studying if the seating in an airplane has an effect on the survivability of an aircraft accident. To study this, we need to look at all aircraft accidents, then rule out the accidents where every passenger survived, and every accident in which every passenger died. This is an extremely narrow data set of accidents. Of these accidents, we gathered the seatings arrangements and survivor seating maps for 47 crashes. 

If 47 crashes look like a lot, we should consider the greater perspective of air travel safety in general.

https://flyfright.com/plane-crash-statistics/#tve-jump-18c020d9166
reported these figures studying the US General aviation data between 2015 and 2020 : 
 
 - $\frac{1}{260256}$ :  chance of boarding any flight and it being an accident flight
 
 - $\frac{1}{6,864,250}$ : chance of being on a plane involved in an accident that results in at least 1 fatality (possible case study of this study)

 - $\frac{1}{816,545,929}$ chance of you specifically, dying in a plane crash
 


 


```{r load data}

data <- read.csv("AllCREEP_cleaned.csv")
# trasform the variables that are categorical into factors
data$fonte <- as.factor(data$fonte)
data$PhaseOfFlight <- as.factor(data$PhaseOfFlight)
data$Time <- as.factor(data$Time)
data$Place <- as.factor(data$Place)
data$HasFire <- as.factor(data$HasFire)
data$Environment <- as.factor(data$Environment)
data$Energy_absorption <- as.factor(data$Energy_absorption)





str(data)
summary(data)
#> data <- read.csv("Aerei_Final.csv")
## 'data.frame': 47 obs. of 26 variables:
## $ Airline : chr "Singapore Airlines" "British Airtours" "British Midland" "China Airlines"
## $ NumVolo : int 6 28 92 120 123 129 140 148 191 204 ...
## $ X1.terzo.lievi : int 17 36 0 0 0 4 0 0 0 3 ...
## $ X1.terzo.gravi : int 2 0 11 0 0 0 0 0 0 0 ...
## $ X1.terzo.morti : int 15 0 22 0 136 14 18 16 55 33 ...
## $ X2.terzo.lievi : int 1 30 4 5 0 5 7 1 0 25 ...
## $ X2.terzo.gravi : int 15 0 30 0 0 0 0 0 8 0 ...
## $ X2.terzo.morti : int 64 16 13 8 214 60 139 34 51 1 ...
## $ X3.terzo.lievi : int 26 10 0 5 36 24 0 8 10 29 ...
## $ X3.terzo.gravi : int 17 0 27 0 0 0 0 0 7 0 ...
## $ X3.terzo.morti : int 0 36 11 21 109 43 91 30 16 0 ...
## $ X1.meta.lievi : int 17 56 32 3 0 7 7 1 0 7 ...
## $ X1.meta.gravi : int 3 0 0 0 0 0 0 0 1 0 ...
## $ X1.meta.morti : int 41 8 34 6 226 23 95 36 79 35 ...
## $ X2.meta.lievi : int 26 20 39 7 4 26 0 7 10 46 ...
## $ X2.meta.gravi : int 31 0 0 0 0 0 0 0 14 0 ...
## $ X2.meta.morti : int 34 44 13 23 225 90 145 46 48 0 ...
## $ fonte : chr "W" "W" "W" "W" ...
## $ PhaseOfFlight : chr "Takeoff" "Takeoff" "Landing" "Landing" ...
## $ Time : chr "Night" "Day" "Night" "Day" ...
2
## $ Place : chr "Airport " "Outside" "Outside" "Airport " ...
## $ HasFire : chr "Fire" "Fire" "Fire" "Fire" ...
## $ Crushed_fuselage : int 1 1 1 1 1 1 1 1 1 1 ...
## $ Restraint_intact : int 0 0 0 1 0 0 0 0 0 0 ...
## $ Environment : chr "dangerous" "dangerous" "dangerous" "clear" ...
## $ Energy_absorption: chr "nogear" "nogear" "gear" "nogear"
                                                                            
                    
```
Some random text....

```{r}
# add a colum of # of seat for each airplain section

data$X1.third.total <- data$X1.terzo.lievi + data$X1.terzo.gravi + data$X1.terzo.morti
data$X2.third.total <- data$X2.terzo.lievi + data$X2.terzo.gravi + data$X2.terzo.morti
data$X3.third.total <- data$X3.terzo.lievi + data$X3.terzo.gravi + data$X3.terzo.morti
data$X1.half.total <- data$X1.meta.lievi + data$X1.meta.gravi + data$X1.meta.morti
data$X2.half.total <- data$X2.meta.lievi + data$X2.meta.gravi + data$X2.meta.morti

str(data)
summary(data)

# now make a colum of mortality rate for each section

data$X1.third.mortality.rate <- data$X1.terzo.morti / data$X1.third.total
data$X2.third.mortality.rate <- data$X2.terzo.morti / data$X2.third.total
data$X3.third.mortality.rate <- data$X3.terzo.morti / data$X3.third.total
data$X1.half.mortality.rate <- data$X1.meta.morti / data$X1.half.total
data$X2.half.mortality.rate <- data$X2.meta.morti / data$X2.half.total



head(data)

```
```{r}
## Plot mortality rates as scatter plots for each section
## they must be separated on the x axis by group

boxplot(data$X1.third.mortality.rate, 
  data$X2.third.mortality.rate, 
  data$X3.third.mortality.rate, 
  data$X1.half.mortality.rate, 
  data$X2.half.mortality.rate, 
  names = c("Front Third", "Middle Third", "Rear Third", "Front Half", "Rear Half"),
  main = "Mortality Rates by Section",
  ylab = "Mortality Rate",
  xlab = "Sections",
  col = c("red", "red", "red", "green", "green"))

```


```{r}
# Perform ANOVA to test if there are significant differences in mortality rates between sections (only  thirds)
mortality_data <- data.frame(
  Section = rep(c("Front Third", "Middle Third", "Rear Third"), each = nrow(data)),
  MortalityRate = c(data$X1.third.mortality.rate, data$X2.third.mortality.rate, data$X3.third.mortality.rate)
)
str(mortality_data)
mortality_data$Section <- as.factor(mortality_data$Section)

anova_result <- aov(MortalityRate ~ Section, data = mortality_data)
summary(anova_result)

library(multcomp)

test_result <- glht(anova_result, linfct = mcp(Section = "Tukey"))
summary(test_result)

#half sections
mortality_data_half <- data.frame(
  Section = rep(c("Front Half", "Rear Half"), each = nrow(data)),
  MortalityRate = c(data$X1.half.mortality.rate, data$X2.half.mortality.rate)
)
anova_result_half <- aov(MortalityRate ~ Section, data = mortality_data_half)
summary(anova_result_half)


#try using non-parametric test if ANOVA assumptions are not met
kruskal_result <- kruskal.test(MortalityRate ~ Section, data = mortality_data)
kruskal_result_half <- kruskal.test(MortalityRate ~ Section, data = mortality_data_half)
kruskal_result
kruskal_result_half

#oneway test

oneway_result <- oneway.test(MortalityRate ~ Section, data = mortality_data, var.equal = FALSE)
oneway_result_half <- oneway.test(MortalityRate ~ Section, data = mortality_data_half, var.equal = FALSE)
oneway_result
oneway_result_half

```

```{r}
# now we do the same thing but considering the "gravi" as casualties too

data$X1.casualties_rate_new <- (data$X1.terzo.morti + data$X1.terzo.gravi) / data$X1.third.total
data$X2.casualties_rate_new <- (data$X2.terzo.morti + data$X2.terzo.gravi) / data$X2.third.total
data$X3.casualties_rate_new <- (data$X3.terzo.morti + data$X3.terzo.gravi) / data$X3.third.total
data$X1.half.casualties_rate_new <- (data$X1.meta.morti + data$X1.meta.gravi) / data$X1.half.total
data$X2.half.casualties_rate_new <- (data$X2.meta.morti + data$X2.meta.gravi) / data$X2.half.total

head(data)


# Plot new casualties rates as scatter plots for each section
boxplot(data$X1.casualties_rate_new, 
  data$X2.casualties_rate_new, 
  data$X3.casualties_rate_new, 
  data$X1.half.casualties_rate_new, 
  data$X2.half.casualties_rate_new, 
  names = c("Front Third", "Middle Third", "Rear Third", "Front Half", "Rear Half"),
  main = "Casualties Rates by Section (Including Serious Injuries)",
  ylab = "Casualties Rate",
  xlab = "Sections",
  col = c("blue", "blue", "blue", "orange", "orange"))  

```


```{r}
# Perform ANOVA to test if there are significant differences in casualties rates between sections (only thirds)
casualties_data <- data.frame(
  Section = rep(c("Front Third", "Middle Third", "Rear Third"), each = nrow(data)),
  CasualtiesRate = c(data$X1.casualties_rate_new, data$X2.casualties_rate_new, data$X3.casualties_rate_new) 
)
anova_casualties_result <- aov(CasualtiesRate ~ Section, data = casualties_data)
summary(anova_casualties_result)

#half sections
casualties_data_half <- data.frame(
  Section = rep(c("Front Half", "Rear Half"), each = nrow(data)),
  CasualtiesRate = c(data$X1.half.casualties_rate_new, data$X2.half.casualties_rate_new) 
)
anova_casualties_result_half <- aov(CasualtiesRate ~ Section, data = casualties_data_half)
summary(anova_casualties_result_half) 

#try using non-parametric test if ANOVA assumptions are not met
kruskal_casualties_result <- kruskal.test(CasualtiesRate ~ Section, data = casualties_data)
kruskal_casualties_result_half <- kruskal.test(CasualtiesRate ~ Section, data = casualties_data_half)
kruskal_casualties_result
kruskal_casualties_result_half

#oneway test
oneway_casualties_result <- oneway.test(CasualtiesRate ~ Section, data = casualties_data, var.equal = FALSE)
oneway_casualties_result_half <- oneway.test(CasualtiesRate ~ Section, data = casualties_data_half, var.equal = FALSE)
oneway_casualties_result
oneway_casualties_result_half


```



```{r}
# t.test only the fisrts third against the rears third
t_test_result <- t.test(data$X1.third.mortality.rate, data$X3.third.mortality.rate, var.equal = FALSE)
t_test_result

#use non-parametric test if t-test assumptions are not met
wilcox_test_result <- wilcox.test(data$X1.third.mortality.rate, data$X3.third.mortality.rate)
wilcox_test_result

```



```{r}
# now we want to test if there is a difference in mortality rate based on the other variables
# PhaseOfFlight, Time, Place, HasFire
# using the total mortality rate, only deaths, do this for evwey third

out <- lm(data$X1.third.mortality.rate ~ data$PhaseOfFlight + data$Time + data$Place + data$HasFire + data$Environment + data$Energy_absorption + data$Crushed_fuselage + data$Restraint_intact)
summary(out)

##simpify the model susins stepwise regression

out_simple <- step(out)
summary(out_simple)

out_2 <- lm(data$X2.third.mortality.rate ~ data$PhaseOfFlight + data$Time + data$Place + data$HasFire + data$Environment + data$Energy_absorption + data$Crushed_fuselage + data$Restraint_intact)
summary(out_2)

out_2_simple <- step(out_2)
summary(out_2_simple)

out_3 <- lm(data$X3.third.mortality.rate ~ data$PhaseOfFlight + data$Time + data$Place + data$HasFire + data$Environment + data$Energy_absorption + data$Crushed_fuselage + data$Restraint_intact)
summary(out_3)

out_3_simple <- step(out_3)
summary(out_3_simple)


#plot the mortality rates based on HasFire
boxplot(data$X1.third.mortality.rate ~ data$HasFire,
        main = "Front Third Mortality Rate by Fire Presence",
        xlab = "Has Fire",
        ylab = "Mortality Rate",
        col = c("yellow", "red"))

boxplot(data$X2.third.mortality.rate ~ data$HasFire,
        main = "Middle Third Mortality Rate by Fire Presence",
        xlab = "Has Fire",
        ylab = "Mortality Rate",
        col = c("yellow", "red")) 

boxplot(data$X3.third.mortality.rate ~ data$HasFire,
        main = "Rear Third Mortality Rate by Fire Presence",
        xlab = "Has Fire",
        ylab = "Mortality Rate",
        col = c("yellow", "red")) 

#and full plane mortality rate
data$Total.mortality.rate <- (data$X1.terzo.morti + data$X2.terzo.morti + data$X3.terzo.morti) / (data$X1.third.total + data$X2.third.total + data$X3.third.total)

boxplot(data$Total.mortality.rate ~ data$HasFire,
        main = "Total Mortality Rate by Fire Presence",
        xlab = "Has Fire",
        ylab = "Mortality Rate",
        col = c("yellow", "red"))

# now for the halves
out_half_1 <- lm(data$X1.half.mortality.rate ~ data$PhaseOfFlight + data$Time + data$Place + data$HasFire + data$Environment + data$Energy_absorption + data$Crushed_fuselage + data$Restraint_intact)
summary(out_half_1)

#simplify the model using stepwise regression
out_half_1_simple <- step(out_half_1 , direction = "both", trace = 0)
summary(out_half_1_simple)


out_half_2 <- lm(data$X2.half.mortality.rate ~ data$PhaseOfFlight + data$Time + data$Place + data$HasFire + data$Environment + data$Energy_absorption + data$Crushed_fuselage + data$Restraint_intact)
summary(out_half_2)

#simplify the model using stepwise regression
out_half_2_simple <- step(out_half_2 , direction = "both", trace = 0)
summary(out_half_2_simple)


#boxplots for halves
boxplot(data$X1.half.mortality.rate ~ data$HasFire,
        main = "Front Half Mortality Rate by Fire Presence",
        xlab = "Has Fire",    
        ylab = "Mortality Rate",
        col = c("lightgreen", "darkgreen"))

boxplot(data$X2.half.mortality.rate ~ data$HasFire,
        main = "Rear Half Mortality Rate by Fire Presence",
        xlab = "Has Fire",
        ylab = "Mortality Rate",
        col = c("lightgreen", "darkgreen")) 

```


```{r}
#same lm analysis but considering casualties (deaths + serious injuries)
out_casualties <- lm(data$X1.casualties_rate_new ~ data$PhaseOfFlight + data$Time + data$Place + data$HasFire + data$Environment + data$Energy_absorption + data$Crushed_fuselage + data$Restraint_intact)
summary(out_casualties)

#simpify the model susins stepwise regression 
out_casualties_simple <- step(out_casualties, direction = "both", trace = 0)
summary(out_casualties_simple)

out_casualties_2 <- lm(data$X2.casualties_rate_new ~ data$PhaseOfFlight + data$Time + data$Place + data$HasFire + data$Environment + data$Energy_absorption + data$Crushed_fuselage + data$Restraint_intact)
summary(out_casualties_2)

out_casualties_2_simple <- step(out_casualties_2, direction = "both", trace = 0)
summary(out_casualties_2_simple)

out_casualties_3 <- lm(data$X3.casualties_rate_new ~ data$PhaseOfFlight + data$Time + data$Place + data$HasFire + data$Environment + data$Energy_absorption + data$Crushed_fuselage + data$Restraint_intact)
summary(out_casualties_3)

out_casualties_3_simple <- step(out_casualties_3, direction = "both", trace = 0)
summary(out_casualties_3_simple)

# now for the halves
out_casualties_half_1 <- lm(data$X1.half.casualties_rate_new ~ data$PhaseOfFlight + data$Time + data$Place + data$HasFire + data$Environment + data$Energy_absorption + data$Crushed_fuselage + data$Restraint_intact)
summary(out_casualties_half_1)

#simplify the model using stepwise regression
out_casualties_half_1_simple <- step(out_casualties_half_1 , direction = "both", trace = 0)
summary(out_casualties_half_1_simple)


out_casualties_half_2 <- lm(data$X2.half.casualties_rate_new ~ data$PhaseOfFlight + data$Time + data$Place + data$HasFire + data$Environment + data$Energy_absorption + data$Crushed_fuselage + data$Restraint_intact)
summary(out_casualties_half_2)
#simplify the model using stepwise regression
out_casualties_half_2_simple <- step(out_casualties_half_2 , direction = "both", trace = 0)
summary(out_casualties_half_2_simple) 




```



```{r}
# now we wnar to study the correlation between the different sections mortality rates
correlation_matrix <- data.frame(
  Front_Third = data$X1.third.mortality.rate,
  Middle_Third = data$X2.third.mortality.rate,
  Rear_Third = data$X3.third.mortality.rate,
  Front_Half = data$X1.half.mortality.rate,
  Rear_Half = data$X2.half.mortality.rate
  
)
correlation_results <- cor(correlation_matrix, use = "complete.obs")
correlation_results

## cor plot
library(corrplot)
corrplot(correlation_results, method = "ellipse", type = "upper", tl.col = "black", tl.srt = 45)

## now study the correlation between the other variables and the total mortality rate
correlation_matrix_2 <- data.frame(
  Total_Mortality_Rate = data$Total.mortality.rate,
  PhaseOfFlight = as.numeric(as.factor(data$PhaseOfFlight)),
  Time = as.numeric(as.factor(data$Time)),
  Place = as.numeric(as.factor(data$Place)),
  HasFire = as.numeric(as.factor(data$HasFire)),
  Environment = as.numeric(as.factor(data$Environment)),
  Energy_absorption = as.numeric(as.factor(data$Energy_absorption)),
  Crushed_fuselage = as.numeric(as.factor(data$Crushed_fuselage)),
  Restraint_intact = as.numeric(as.factor(data$Restraint_intact))
)
correlation_results_2 <- cor(correlation_matrix_2, use = "complete.obs")
correlation_results_2

corrplot(correlation_results_2, method = "ellipse", type = "upper", tl.col = "black", tl.srt = 45)



```
# Data Description

This is an example of r-chuch. You can instrt the R code, Knit-it and your report
is compiled in pdf.

```{r}
x <- rnorm(1000)
hist(x)
```

# Analysis

# Results 

# Conclusions
